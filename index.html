<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta content="width=device-width, initial-scale=1.0" name="viewport" />
    <title>No jQuery Example</title>

    <link href="assets/img/apple-touch-icon.png" rel="apple-touch-icon" />
    <link rel="icon" type="image/png" href="my-icon.png" />

    <!-- OR Font Awesome 5/6 -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"
    />

    <!-- Main CSS File -->
    <link href="assets/css/main.css" rel="stylesheet" />
  </head>
  <body>
    <div class="container">
      <section class="section-padding">
        <div class="gradient-section">
          <div class="asset-top-image"><img src="/assets/img/image-1.png"></img></div>
          <div class="header-section">
            <h1>Discover Honest Place Reviews</h1>
            <h4>“Find the best place recommended by real people.”</h4>
          </div>

          <div class="features-container">
            <div class="loading" id="loading">Loading...</div>
            <div class="features-grid" id="reviews-container"></div>
          </div>

          <div class="wrapper">
            <!-- Arrow Left -->
            <button
              class="btn btn-primary"
              onclick="prevSlide()"
              id="prevButton"
            >
              <i class="fa-solid fa-angle-left"></i>
            </button>
            <!-- <i class="fa-solid fa-angle-left" id="prevButton" onclick="prevSlide()"></i> -->
            <div class="dots-container" id="dotsContainer"></div>
            <!-- Arrow Right -->
            <button
              class="btn btn-primary"
              onclick="nextSlide()"
              id="nextButton"
            >
              <i class="fa-solid fa-angle-right"></i>
            </button>
            <!-- <i class="fa-solid fa-angle-right" id="nextButton" onclick="nextSlide()"></i> -->
          </div>
        </div>
      </section>

    </div>

    <script
      src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDBpXc9w5OWjGjP7J7bwS-hRSxgCPKCkZQ&libraries=places"
      async
      defer
    ></script>

    <script>
      let currentSlide = 0;
      let itemsPerSlide = 4;
      let reviews = [];

      const container = document.getElementById("reviews-container");
      const loading = document.getElementById("loading");

      function getPlaceDetails(placeId) {

        loading.style.display = "flex";
        // container.style.display = "none";

        return new Promise((resolve, reject) => {
          const service = new google.maps.places.PlacesService(
            document.createElement("div")
          );
          const request = {
            placeId: placeId,
            fields: [
              "name",
              "rating",
              "user_ratings_total",
              "reviews",
              "formatted_address",
            ],
          };

          service.getDetails(request, (place, status) => {
            if (status === google.maps.places.PlacesServiceStatus.OK && place) {
              loading.style.display = "none";
              resolve(place.reviews);
              
            } else {
              reject("Failed to fetch place details");
            }
          });
        });
      }

      window.onload = async function () {
        try {
          const reviewsData = await getPlaceDetails(
            "ChIJ2dGMjMMEdkgRqVqkuXQkj7c"
          );
          console.log("Reviews count:", reviewsData); 
          reviews = reviewsData || [];
          initCarousel();
          
          reviews.forEach((review, index) => {
            const div = document.createElement("div");
            div.className = `feature-item`;
            div.innerHTML = `
            <div class="quote-icon">"</div>
            <div class="feature-header">
              <div class="feature-icon">
                <img src=${review.profile_photo_url}></img></div>
              <div class="feature-info">
                <h4>${review.author_name}</h4>
                <div class="feature-time">${
                  review.relative_time_description
                }</div>
              </div>
            </div>
            <div class="stars">
              ${generateStars(review.rating)}
            </div>
            <div class="review-text">
              <div class="feature-review review-${index}" id="reviewText">${review.text}</div>
            </div>
            `;
            
            container.appendChild(div);
          });
        } catch (err) {
          console.error(err);
        }
      };

      function generateStars(rating) {
        let starsHTML = "";
        for (let i = 1; i <= 5; i++) {
          starsHTML += `<span class="star ${
            i > rating ? "empty" : ""
          }">⭐</span>`;
        }
        return starsHTML;
      }

      function updateCarousel() {
        const itemHeight = container.offsetHeight;
        console.log("Item Height:", container.offsetHeight);
        if ( window.innerWidth <= 480 ) {
          container.style.transform = `translateY(-${currentSlide * 716}px)`;
        } else {
          container.style.transform = `translateX(-${currentSlide * 100}%)`;
        }
        
        updateDots();
        updateDisabledNavButtons();
      }

      function updateItemsPerSlide() {
        const width = window.innerWidth;
        // if (width <= 480) {
        //   itemsPerSlide = 1;
        // } else 
        if (width <= 768) {
          itemsPerSlide = 2;
        } else if (width <= 1024) {
          itemsPerSlide = 3;
        } else {
          itemsPerSlide = 4;
        }
        generateDots();
      }

      function getTotalSlides() {
        return Math.ceil(reviews.length / itemsPerSlide);
      }

      function generateDots() {
        const dotsContainer = document.getElementById("dotsContainer");
        let dots = "";
        const totalSlides = getTotalSlides();

        for (let i = 0; i < totalSlides; i++) {
          dots += `<div class="dot ${
            i === currentSlide ? "active" : ""
          }" data-index="${i}" onclick="goToSlide(${i})"></div>`;
        }
        dotsContainer.innerHTML = dots;
      }

      function updateDots() {
        const dots = document.querySelectorAll(".dot");
        dots.forEach((dot, index) => {
          dot.classList.toggle("active", index === currentSlide);
        });
      }

      function nextSlide() {
        const totalSlides = getTotalSlides();
        if (currentSlide < totalSlides - 1) {
          currentSlide++;
          updateCarousel();
        }
      }

      function prevSlide() {
        if (currentSlide > 0) {
          currentSlide--;
          updateCarousel();
        }
      }

      function goToSlide(index) {
        const totalSlides = getTotalSlides();
        if (index >= 0 && index < totalSlides) {
          currentSlide = index;
          updateCarousel();
        }
      }

      function updateDisabledNavButtons() {
        const prevBtn = document.getElementById("prevButton");
        const nextBtn = document.getElementById("nextButton");
        const totalSlides = getTotalSlides();
        
        prevBtn.disabled = currentSlide === 0;
        nextBtn.disabled = currentSlide >= totalSlides - 1;
      }

      function initCarousel() {
        // renderReviews();
        updateItemsPerSlide();
        // updateSlideWidths();
        generateDots();
        getTotalSlides();
        updateCarousel();
      }

      window.addEventListener("resize", () => {
        const oldItemsPerSlide = itemsPerSlide;
        updateItemsPerSlide();
        updateCarousel();
    
        if (oldItemsPerSlide !== itemsPerSlide) {
          currentSlide = 0;
          updateCarousel();
        }
      });
    </script>
  </body>
</html>
